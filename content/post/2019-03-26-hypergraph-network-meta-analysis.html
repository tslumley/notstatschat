---
title: Hypergraph network meta-analysis
author: Thomas Lumley
date: '2019-03-26'
slug: hypergraph-network-meta-analysis
categories: []
tags: []
---



<p>‘Network meta-analysis’ is the only term I’ve coined that’s actually entered the general biostatistical vocabulary. In network meta-analysis we work with a network of randomised trials, where the nodes are interventions and the edges are trials. A single edge represents a direct randomised comparison; a path represents an indirect (but unconfounded) estimate from multiple trials; we can combine multiple paths between interventions using a linear model.</p>
<p>For example, if <span class="math inline">\(\log RR_{ij,j}\)</span> is the log relative risk in the <span class="math inline">\(k\)</span>th trial of treatments <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, and it has variance <span class="math inline">\(\sigma^2_{ij,k}\)</span> <span class="math display">\[\log RR_{ij,k} = \beta_i-\beta_j+\epsilon_{ij,k}\]</span> where <span class="math inline">\(\epsilon_{ij,k}\sim N(0,\sigma^2_{ij,k})\)</span>.</p>
<p>Here’s an example network, of trials of antihypertensive treatments that reported some real clinical outcomes such as heart attack or stroke. It’s the network from <a href="https://www.ncbi.nlm.nih.gov/pubmed/12759325">this paper</a>, with <span class="math inline">\(\alpha\)</span>-blockers taken out. <img src="/post/2019-03-26-hypergraph-network-meta-analysis_files/network.png" style="width:80.0%" /></p>
<p>The simple linear model doesn’t allow for heterogeneity between trials of the same pair of treatments (heterogeneity), and also doesn’t allow for the effect of treatment <span class="math inline">\(i\)</span> to be systematically different depending on what it’s compared two (which I called ‘incoherence’ and everyone else calls ‘inconsistency’). Heterogeneity and incoherence have the same basic causes: eg, differences in who would be randomised between this pair of treatments and in what other care they are given.</p>
<p>We know how to estimate heterogeneity for a given pair of treatments. Incoherence is only estimable when you have at least three treatments, and at least one loop in the network; one way to estimate it is by the sums of treatment effects around loops, which should be zero. We can fit a linear mixed model <span class="math display">\[\log RR_{ij,k} = \beta_i-\beta_j+\epsilon_{ij,k}+\eta_{ij,k}+\xi_{ij}\]</span> where now <span class="math inline">\(\eta\sim N(0,\tau^2_{ij})\)</span> represents heterogeneity and <span class="math inline">\(\xi_{ij}\sim N(0,\omega^2_{ij})\)</span> represents incoherence. Note that the incoherence effects <span class="math inline">\(\xi\)</span> do not average away as <span class="math inline">\(k\)</span> increases: they represent systematic differences in the sort of patients who were randomised between, say <span class="math inline">\(A\)</span> vs placebo and <span class="math inline">\(A\)</span> vs <span class="math inline">\(B\)</span>. The benefit of having a separate variance component for incoherence is that there’s not much information about incoherence in a typical network and we would prefer not to have it swamped by heterogeneity.</p>
<p>There’s a problem, though. The network above contains two three-armed trials. In a three-armed trial there is loop in the network entirely contained in one trial, which – as a matter of arithmetic – sums to zero. We will tend to underestimate incoherence when there are multi-armed trials. [Also, in a <span class="math inline">\(k\)</span>-armed trial, each individuals contributes to <span class="math inline">\(k-1\)</span> edges, but that can be handled by weighting]</p>
<p>The problem is because a graph is not a flexible enough data structure to represent multi-armed trials: we need a <em>hypergraph</em>. Hypergraphs sound scary, but there’s a straightforward representation of them as bipartite graphs: graphs with two types of nodes.</p>
<p>Here’s a simpler network: <img src="/post/2019-03-26-hypergraph-network-meta-analysis_files/smol-network.png" style="width:70.0%" /></p>
<p>The three red edges could be three separate trials or three arms of one trial; the graph can’t distinguish, but the calculations have to.</p>
<p>We can rewrite the network with two sets of nodes – intervention nodes and trial nodes – and edges representing trial arms. If the three red edges are in different trials we get <img src="/post/2019-03-26-hypergraph-network-meta-analysis_files/is-loop.png" style="width:90.0%" /></p>
<p>with trials numbered at random. We have all the same paths between treatments as in the original graph, but now a path between two treatments involves one or more <em>pairs</em> of edges. The edges in each pair must be necessarily be in the same trial or they won’t join up, so we’re still preserving randomisation. There’s still a red loop, as there should be: the red edges do contribute to incoherence.</p>
<p>If the three red edges are in the same trial, we get <img src="/post/2019-03-26-hypergraph-network-meta-analysis_files/not-loop.png" style="width:90.0%" /></p>
<p>with no red loops. The spurious loop that’s entirely within the three-armed trial has disappeared!</p>
<p>We can now write a linear mixed model based on the bipartite graph. It’s harder to distinguish incoherence and heterogeneity. Writing <span class="math inline">\(P[\textrm{event}]_{i,k}\)</span> for the probability of an event in trial <span class="math inline">\(k\)</span>, intervention <span class="math inline">\(i\)</span>, we could simplify to <span class="math display">\[\log P[\textrm{event}]_{i,k} = \beta_i+\epsilon_{i,k}+\eta_{i,k}.\]</span> To add incoherence we’d need <span class="math inline">\(\xi_{i:\textrm{combo}}\)</span> random effects representing the bias in treatment <span class="math inline">\(i\)</span> when it’s one of a specific combination of options. At that point it’s probably worth putting a more explicit prior on the incoherence effects.</p>
<p>Lin Bi did a short MSc research project with me on this idea, and it seems to work. Since that was in about 2012, it doesn’t look as though either of us is going to publish it any time soon, so at least there’s a blog post.</p>
